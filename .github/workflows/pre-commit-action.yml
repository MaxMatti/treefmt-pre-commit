name: Pre-commit Action
on:
  workflow_run:
    workflows: ["Manual Publish to PyPI", "main"]
    types:
      - completed
jobs:
  pre-commit-action:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-python@v5
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - uses: actions/setup-go@v5
        with:
          go-version: 'stable'
      - name: Install formatters
        run: |
          # Install Python formatters
          pip install ruff

          # Install Node.js based formatters
          npm install -g prettier @taplo/cli

          # Install Go based formatters
          go install github.com/google/yamlfmt/cmd/yamlfmt@latest

          # Add Go bin to PATH
          echo "$HOME/go/bin" >> $GITHUB_PATH
      - uses: pre-commit/action@v3.0.1
